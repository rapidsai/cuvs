/*
 * SPDX-FileCopyrightText: Copyright (c) @year@, NVIDIA CORPORATION.
 * SPDX-License-Identifier: Apache-2.0
 */

// This file is auto-generated. Do not edit manually.

#ifdef BUILD_KERNEL

// Include helpers first so they're available when the JIT kernel is instantiated
#include <neighbors/detail/cagra/jit_lto_kernels/search_multi_cta_helpers.cuh>  // For pickup_next_parent and topk_by_bitonic_sort_wrapper_*

#include <neighbors/detail/cagra/jit_lto_kernels/search_multi_cta_kernel_jit.cuh>

namespace cuvs::neighbors::cagra::detail::multi_cta_search {

// Instantiate the search_kernel_jit function with unified template parameters
// For standard descriptors: PQ_BITS=0, PQ_LEN=0, CodebookT=void
// For VPQ descriptors: PQ_BITS>0, PQ_LEN>0, CodebookT=half
// Note: Metric is no longer a template parameter - it's linked via dist_op and normalization fragments
// Note: Descriptor type is no longer instantiated here - kernels use void* and accessor fragments
template __global__ __launch_bounds__(1024, 1) void search_kernel_jit<@team_size@, @dataset_block_dim@, @pq_bits@, @pq_len@, @codebook_type@, @data_type@, @index_type@, @distance_type@, @source_index_type@>(
    @index_type@* const, @distance_type@* const, void*, const @data_type@* const, const @index_type@* const, const std::uint32_t, const std::uint32_t, const @source_index_type@*, const unsigned, const uint64_t, const @index_type@*, const std::uint32_t, const std::uint32_t, @index_type@* const, const std::uint32_t, const std::uint32_t, const std::uint32_t, const std::uint32_t, std::uint32_t* const, const std::uint32_t, uint32_t*, @source_index_type@, @source_index_type@);

}  // namespace cuvs::neighbors::cagra::detail::multi_cta_search

#else

#include <cuvs/detail/jit_lto/RegisterKernelFragment.hpp>
#include <cuvs/detail/jit_lto/cagra/search_single_cta_tags.hpp>
#include "search_multi_cta_kernel@pq_prefix@_t@team_size@_dim@dataset_block_dim@@pq_suffix@_@type_abbrev@_@idx_abbrev@_@dist_abbrev@_@src_idx_abbrev@.h"

using namespace cuvs::neighbors::cagra::detail;

__attribute__((__constructor__)) static void register_search_multi_cta_kernel@pq_prefix@_@type_abbrev@_@idx_abbrev@_@dist_abbrev@_@src_idx_abbrev@()
{
  registerAlgorithm<tag_@type_abbrev@,
    tag_idx_@idx_abbrev@,
    tag_dist_@dist_abbrev@,
    tag_idx_@src_idx_abbrev@@codebook_tag@>(
    "search_multi_cta_kernel@pq_prefix@_t@team_size@_dim@dataset_block_dim@@pq_suffix@",
    embedded_search_multi_cta_kernel@pq_prefix@_t@team_size@_dim@dataset_block_dim@@pq_suffix@_@type_abbrev@_@idx_abbrev@_@dist_abbrev@_@src_idx_abbrev@,
    sizeof(embedded_search_multi_cta_kernel@pq_prefix@_t@team_size@_dim@dataset_block_dim@@pq_suffix@_@type_abbrev@_@idx_abbrev@_@dist_abbrev@_@src_idx_abbrev@));
}

#endif
