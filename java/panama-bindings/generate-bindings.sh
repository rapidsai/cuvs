#!/bin/bash

REPODIR=$(cd $(dirname $0); cd ../../ ; pwd)
CURDIR=$(cd $(dirname $0); pwd)
CUDA_HOME=$(which nvcc | cut -d/ -f-4)

jextract \
 --include-dir ${REPODIR}/cpp/build/_deps/dlpack-src/include/ \
 --include-dir ${CUDA_HOME}/include \
 --include-dir ${REPODIR}/cpp/include \
 --output ${CURDIR}/bindings \
 --target-package com.nvidia.cuvs.internal.panama \
 --header-class-name PanamaBindings \
 ${CURDIR}/headers.h

# Insert license headers in the generated files
for file in ${CURDIR}/bindings/com/nvidia/cuvs/internal/panama/*; do
  sed -i '1s/^/\n\/\/ NOTE: PLEASE DO NOT EDIT THIS FILE MANUALLY\n/' $file
  cat ${CURDIR}/license-header.txt $file > temp && mv temp $file
done
