name: pr
on:
  push:
    branches:
      - "pull-request/[0-9]+"
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
jobs:
  pr-builder:
    needs:
      - java-build
    secrets: inherit
    uses: rapidsai/shared-workflows/.github/workflows/pr-builder.yaml@cuda13.0
    if: always()
    with:
      needs: ${{ toJSON(needs) }}
  java-build:
    secrets: inherit
    uses: rapidsai/shared-workflows/.github/workflows/custom-job.yaml@cuda13.0
    strategy:
      fail-fast: false
      matrix:
        cuda_version:
          - '12.9.1'
          # - '13.0.0'
    with:
      build_type: pull-request
      arch: "amd64"
      # ci-wheel Rocky Linux 8 images are used to ensure the built libcuvs{_c}.so and dependencies
      # respect RAPIDS minimum GLIBC version and are portable for re-use in environments not using
      # 'conda' or 'pip'
      container_image: "rapidsai/ci-wheel:25.10-cuda${{ matrix.cuda_version }}-rockylinux8-py3.13"
      script: "ci/build_java_portable_fat_jar.sh"
      artifact-name: "cuvs-java-cuda${{ matrix.cuda_version }}"
      file_to_upload: "java/cuvs-java/target/"
